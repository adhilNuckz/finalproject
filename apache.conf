<VirtualHost *:80>
    ServerName 142.93.220.168
    DocumentRoot /root/LOCALED/front/dist

    # Frontend static files
    <Directory /root/LOCALED/front/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Enable rewrite for SPA routing
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # Proxy API requests to backend
    ProxyPreserveHost On
    ProxyPass /api http://localhost:5002
    ProxyPassReverse /api http://localhost:5002

    # Proxy Socket.IO for backend (WebSocket support)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/socket.io/(.*) ws://localhost:5002/socket.io/$1 [P,L]
    
    ProxyPass /socket.io http://localhost:5002/socket.io
    ProxyPassReverse /socket.io http://localhost:5002/socket.io

    # Proxy terminal service (WebSocket support)
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/terminal/(.*) ws://localhost:3000/$1 [P,L]
    
    ProxyPass /terminal http://localhost:3000
    ProxyPassReverse /terminal http://localhost:3000

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/localed-error.log
    CustomLog ${APACHE_LOG_DIR}/localed-access.log combined
</VirtualHost>
